!function(){"use strict";var $;$=jQuery,(new function(){var e,t,n=this;this.init=function(){$(document).on("click",".fusewp-add-action",this.addDestination),$(document).on("click",".fusewp-delete-action",this.deleteDestination),$(document).on("click",".fusewp-edit-action, .fusewp-action__header",this.toggleDestinationItem),$(document).on("change",".fusewp-source-select",this.onSourceChange),$(document).on("change",".fusewp-action-select",this.onDestinationChange),$(document).on("change",".fusewp-integration-select",this.onIntegrationChange),$(document).on("change",".fusewp-sync-list-select",this.onIntegrationListChange),$(document).on("click",".fusewp_map_field_btn",this.mapAnotherFieldOnClick),$(document).on("click",".fusewp-map-field-table-delete-icon",this.deleteFieldMapRowOnClick),$(document).on("click",".fusewp-switch.fusewp-toggle-sync-status",this.syncStatusSwitch),$(document).on("ready",this.onReady)},this.initScript=function(){$(".fusewp-field-select2").select2()},this.onReady=function(){e=wp.template("fusewp-destination-item"),t=wp.template("fusewp-source-information"),window.fusewp_destination_items=fusewp_obj.fusewp_destination_items,window.fusewp_destination_item_label=fusewp_obj.fusewp_destination_item_label},this.add_spinner=function(){n.remove_spinner(),$("#poststuff").prepend('<div class="fusewp_preloader"><span class="spinner is-active"></span></div>')},this.remove_spinner=function(){$(".fusewp_preloader").remove()},this.show_source_empty_state=function(){$("#fusewp-sync-destination-content .fusewp-no-actions-message p").html(fusewp_obj.sync_page_no_source_message),$("#fusewp-sync-destination-content .fusewp-no-actions-message").show()},this.onSourceChange=function(e){var s=$(this).val();if($(".fusewp-sync-source-info").remove(),$(".fusewp-actions-container .fusewp-action").remove(),""!==s){n.add_spinner();var i={action:"fusewp_sync_get_source_data",source:s,csrf:fusewp_obj.nonce};jQuery.post(ajaxurl,i,(function(e){n.remove_spinner(),"success"in e&&!0===e.success?(window.fusewp_destination_items=e.data.destination_items,window.fusewp_destination_item_label=e.data.destination_item_label,$("#fusewp-sync-destination-content .fusewp-actions-container").prepend(t({message:e.data.rule_information})),$("#fusewp-sync-destination-content .fusewp-no-actions-message p").html(fusewp_obj.sync_page_no_destination_message),$(".fusewp-metabox-footer").addClass("fusewp-show")):alert(e.data)}))}else n.show_source_empty_state(),$(".fusewp-metabox-footer").removeClass("fusewp-show")},this.onDestinationChange=function(){$(this).parents(".fusewp-action").find(".action-title").text(jQuery("option:selected",$(this)).text())},this.onIntegrationChange=function(e){var t=$(this),s=t.val(),i=t.parents(".fusewp-action");if(t.closest(".fusewp-action__fields").find(".fusewp-sub-fields").remove(),""!==s){n.add_spinner();var a={action:"fusewp_sync_get_integration_fields",integration:s,index:i.data("index"),csrf:fusewp_obj.nonce};jQuery.post(ajaxurl,a,(function(e){n.remove_spinner(),"success"in e&&!0===e.success?(t.parents(".fusewp-table tbody").append(e.data.integration_fields),n.initScript()):alert(e.data)}))}},this.onIntegrationListChange=function(e){var t=$(this),s=t.val(),i=t.parents(".fusewp-action"),a=$(".fusewp-integration-select",i).val();if(t.closest(".fusewp-action__fields").find(".fusewp-list-sub-fields").remove(),""!==s){n.add_spinner();var o={action:"fusewp_sync_get_list_fields",integration:a,list_id:s,index:i.data("index"),csrf:fusewp_obj.nonce};jQuery.post(ajaxurl,o,(function(e){n.remove_spinner(),"success"in e&&!0===e.success?(t.parents(".fusewp-table tbody").append(e.data.integration_list_fields),n.initScript()):alert(e.data)}))}},this.addDestination=function(t){t.preventDefault();var n,s=1,i=$("#fusewp-sync-destination-content .fusewp-actions-container .fusewp-action");i.length>0&&(s=i.eq(-1).data("index")+1),$("#fusewp-sync-destination-content .fusewp-no-actions-message").hide(),n=e({index:s,source_item_name:window.fusewp_destination_item_label,destination_items:window.fusewp_destination_items}),$("#fusewp-sync-destination-content .fusewp-actions-container").append(n)},this.deleteDestination=function(e){e.preventDefault(),confirm(fusewp_obj.confirm_delete)&&($(this).closest(".fusewp-action").remove(),0===$(".fusewp-actions-container .fusewp-action").length&&$("#fusewp-sync-destination-content .fusewp-no-actions-message").show())},this.toggleDestinationItem=function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).parents(".fusewp-action").toggleClass("fusewp-open")},this.mapAnotherFieldOnClick=function(e){e.preventDefault();var t=$(this).closest("table"),n=$("tbody tr",t).eq(0).clone();n.find(".fusewp-map-field-table-data select").val(""),n.find(".fusewp-map-field-table-field-value select").val(""),$("tbody",t).append(n)},this.deleteFieldMapRowOnClick=function(e){e.preventDefault(),$(this).closest("tr").remove()},this.syncStatusSwitch=function(){var e=$(this);if(!e.is(".fusewp-loading")){var t="active"===e.attr("data-fusewp-switch")?"disabled":"active";e.addClass("fusewp-loading"),e.attr("data-fusewp-switch",t),$.post(ajaxurl,{action:"fusewp_toggle_sync_status",sync_rule_id:e.attr("data-sync-id"),new_state:t},(function(){e.removeClass("fusewp-loading")}))}}}).init()}();